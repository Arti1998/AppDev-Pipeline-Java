@Library('github.com/ranjitaws2020/java-shared-library@pipeline') _

pipeline {
    agent any 
     environment {
        azcon = credentials('az_sp')
        IMAGE_NAME = 'javasampletomcat'
        IMAGE_TAG = '10'
        AKS_NAMESPACE = 'default'
        AKS_DEPLOYMENT_NAME = 'aks-deployment-name'
        acrLoginServer = 'myacr032023.azurecr.io'
    }
    tools {
        maven 'maven-home'
        jdk 'jdk8'
        
    }
    stages {
        stage('Pull the file off Nexus') {
            steps{
                  DownloadFromNexus()                    
            }
        }
         stage('Fetch Public IP') {
            steps {
                   FetchPublicIPOfVM()               
            }
        }
         stage('Deploy to AKS') {
            steps {
                script {
                    DeployACRImageToAKS()             
                }
            }
        }
    }
}
